{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
  <div class="chat-wrapper">
    <div class="chat-history" id="chat-history">
      <div class="welcome" id="empty-state">
        <!-- Animated background elements (full width) -->
        <div class="welcome__bg">
          <div class="welcome__blob welcome__blob--1"></div>
          <div class="welcome__blob welcome__blob--2"></div>
          <div class="welcome__blob welcome__blob--3"></div>
          <div class="welcome__grid"></div>
          <div class="welcome__particles" id="particles-container"></div>
        </div>

        <!-- Main content constrained to 964px -->
        <div class="container">
          <div class="welcome__content">
            <!-- Logo with glow effect -->
            <div class="welcome__logo">
              <div class="welcome__logo-glow"></div>
              <div class="welcome__icon">ðŸ’Ž</div>
            </div>

            <!-- Title section with gradient -->
            <div class="welcome__header">
              <h1 class="welcome__title">SAC Learning GEMS</h1>
              <p class="welcome__subtitle">
                Transforme sua forma de aprender atravÃ©s de uma jornada personalizada com 7 agentes especializados de IA
              </p>
            </div>

            <!-- Features badges -->
            <div class="welcome__features">
              <div class="welcome__badge">Mapeie seus objetivos de vida</div>
              <div class="welcome__badge">Identifique desafios reais</div>
              <div class="welcome__badge">Aprenda com ciÃªncia comprovada</div>
              <div class="welcome__badge">Construa seu assistente personalizado</div>
            </div>

            <!-- CTA Button -->
            <div class="welcome__actions">
              <button class="welcome__cta" onclick="document.getElementById('message').value='iniciar'; document.getElementById('chat-form').requestSubmit();">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
                ComeÃ§ar Jornada
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="input-wrapper" id="input-wrapper">
        <form class="chat-form" id="chat-form">
          <div class="input-container">
            <textarea
              class="input-field"
              id="message"
              name="message"
              rows="1"
              placeholder="Envie uma mensagem..."
              required
              autocomplete="off"
            ></textarea>
            <button class="send-button" type="submit" id="submit-button" aria-label="Enviar mensagem">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M7 11L12 6L17 11M12 18V7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- Theme Toggle -->
<button class="theme-toggle" id="theme-toggle" title="Alternar tema">
  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
    <path d="M12 3V5M12 19V21M5 12H3M21 12H19M18.36 18.36L17.64 17.64M6.34 6.34L5.64 5.64M18.36 5.64L17.64 6.34M6.34 18.36L5.64 17.64M16 12C16 14.209 14.209 16 12 16C9.791 16 8 14.209 8 12C8 9.791 9.791 8 12 8C14.209 8 16 9.791 16 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
</button>

<!-- Logout Button -->
<button class="logout-button" id="logout-button" title="Sair" style="display: none;">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
    <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9M16 17L21 12M21 12L16 7M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
</button>

<!-- History Sidebar -->
<div class="history-sidebar" id="history-sidebar">
  <div class="history-header">
    <h3>HistÃ³rico de Conversas</h3>
    <button class="close-sidebar" id="close-sidebar" aria-label="Fechar histÃ³rico">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
  </div>
  <div class="history-actions">
    <button class="btn btn--primary btn--small" id="new-chat-button">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
        <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      Nova Conversa
    </button>
  </div>
  <div class="history-list" id="history-list">
    <!-- Chat history will be loaded here -->
  </div>
</div>

<!-- History Toggle Button -->
<button class="history-toggle" id="history-toggle" title="HistÃ³rico de conversas">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
    <path d="M3 12H21M3 6H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
  </svg>
</button>

<script src="{{ url_for('static', path='auth.js') }}" type="module"></script>
<script src="{{ url_for('static', path='conversations.js') }}" type="module"></script>
<script src="{{ url_for('static', path='app.js') }}" type="module"></script>

<style>
.logout-button {
  position: fixed;
  top: 1.5rem;
  right: 5rem;
  width: 2.75rem;
  height: 2.75rem;
  border: none;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  z-index: 1000;
}

.logout-button:hover {
  background: rgba(239, 68, 68, 0.2);
  transform: scale(1.1);
}

.logout-button svg {
  color: currentColor;
}
</style>

<script>
// Verificar autenticaÃ§Ã£o ao carregar pÃ¡gina
window.addEventListener('DOMContentLoaded', async () => {
  const auth = window.authManager;
  const user = await auth.checkAuth();

  if (user) {
    // Mostrar botÃ£o de logout
    const logoutBtn = document.getElementById('logout-button');
    if (logoutBtn) {
      logoutBtn.style.display = 'flex';
      logoutBtn.addEventListener('click', () => {
        if (confirm('Deseja realmente sair?')) {
          auth.logout();
        }
      });
    }
  }
});
</script>
{% endblock %}
